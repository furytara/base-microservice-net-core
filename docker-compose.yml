version: '3.7'

services:
  phungdkh.microservice.api:
    container_name: microservice-api
    image: phungdkh/microservice-api
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=https://+:443;http://+:80
    build:
      context: .
      dockerfile: Services/Categories/PhungDKH.Microservice.Api/Dockerfile
    ports:
      - 1111:443
    depends_on:
      - db1
      - rabbitmq
    networks:
      - phungdkh-brigde
  db1:
    container_name: phungdkh.mssql.db
    image: microsoft/mssql-server-linux:2017-latest
    environment:
      MSSQL_SA_PASSWORD: "phungdkh@!@#123"
      ACCEPT_EULA: "Y"
      MSSQL_TCP_PORT: 1433
    ports:
      - 1433:1433
    volumes:
      - mssql-db-data:/var/opt/mssql
    networks:
      - phungdkh-brigde
  rabbitmq:
    container_name: phungdkh.rabbitmq
    image: rabbitmq:3.7-management  
    environment:
      RABBITMQ_DEFAULT_USER: guest
      RABBITMQ_DEFAULT_PASS: guest 
    ports:
      - 15672:15672
      - 5672:5672
    networks: 
      - phungdkh-brigde
  phungdkh.identity.api:
    container_name: identity-api
    image: phungdkh/identity-api
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=https://+:443;http://+:80
    build:
      context: .
      dockerfile: Services/Identity/PhungDKH.Identity.Api/Dockerfile
    ports:
      - 2222:443
    depends_on:
      - db1
    networks: 
      - phungdkh-brigde
volumes:
  mssql-db-data:

networks:
  phungdkh-brigde:
    driver: bridge
